<UserControl x:Class="centre_soutien.Views.GestionInscriptionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:centre_soutien.Views"
             xmlns:viewModels="clr-namespace:centre_soutien.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             FontFamily="Segoe UI">

    <UserControl.Resources>
        <!-- Styles communs (inspirés de GestionMatieresView) -->
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10 5"/>
            <Setter Property="Margin" Value="0 5"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Background" Value="#FF3A4F7A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="3" ShadowDepth="1" Color="#40000000"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF4A6FA5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style pour le DataGrid -->
        <Style TargetType="DataGrid">
            <Setter Property="Margin" Value="0 0 0 15"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#F5F5F5"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#FF3A4F7A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10 5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        
        <!-- Style pour les TextBlocks (si nécessaire, mais le titre sera un cas particulier) -->
        <!-- <Style TargetType="TextBlock"> -->
        <!-- <Setter Property="Margin" Value="5"/> -->
        <!-- </Style> -->

    </UserControl.Resources>

    <d:UserControl.DataContext>
        <viewModels:InscriptionViewModel/>
    </d:UserControl.DataContext>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Titre et bouton "Nouvelle Inscription" -->
            <RowDefinition Height="*"/>    <!-- DataGrid -->
            <RowDefinition Height="Auto"/> <!-- Bouton "Désinscrire" -->
            <RowDefinition Height="Auto"/> <!-- StatusBar -->
        </Grid.RowDefinitions>

        <!-- Zone d'actions en haut (Titre + Bouton) -->
        <Grid Grid.Row="0" Margin="0 0 0 15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Gestion des Inscriptions" 
                       FontSize="24" FontWeight="SemiBold" VerticalAlignment="Center"
                       Foreground="#FF3A4F7A">
                <TextBlock.Effect>
                    <DropShadowEffect BlurRadius="5" ShadowDepth="1" Color="#20000000"/>
                </TextBlock.Effect>
            </TextBlock>

            <Button Grid.Column="1" Content="Nouvelle Inscription..." 
                    Command="{Binding OpenAddInscriptionDialogCommand}" 
                    VerticalAlignment="Center" MinWidth="150"/> <!-- Style de bouton s'applique -->
        </Grid>

        <!-- DataGrid -->
        <DataGrid Grid.Row="1" ItemsSource="{Binding Inscriptions}"
                  SelectedItem="{Binding SelectedInscription, Mode=TwoWay}"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  CanUserAddRows="False">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID Ins." Binding="{Binding IDInscription}" Width="Auto"/>
                <DataGridTextColumn Header="Étudiant" Binding="{Binding Etudiant.NomComplet}" Width="2*"/>
                <DataGridTextColumn Header="Groupe" Binding="{Binding Groupe.NomDescriptifGroupe}" Width="2*"/>
                <DataGridTextColumn Header="Matière" Binding="{Binding Groupe.Matiere.NomMatiere}" Width="*"/>
                <DataGridTextColumn Header="Date Insc." Binding="{Binding DateInscription, StringFormat=dd/MM/yyyy}" Width="Auto"/>
                <DataGridTextColumn Header="Prix Convenu" Binding="{Binding PrixConvenuMensuel, StringFormat=C2}" Width="Auto"/>
                <DataGridTextColumn Header="Jour Éch." Binding="{Binding JourEcheanceMensuelle}" Width="Auto"/>
                <DataGridCheckBoxColumn Header="Active" Binding="{Binding EstActif}" Width="Auto"/>
                <DataGridTextColumn Header="Date Désinsc." Binding="{Binding DateDesinscription, StringFormat=dd/MM/yyyy, TargetNullValue='-'}" Width="Auto"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Bouton d'action contextuel (Désinscrire) -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 15">
            <Button Content="Désinscrire Sélection" Command="{Binding DesinscrireCommand}" MinWidth="160"/>
        </StackPanel>

        <!-- Barre de statut -->
        <StatusBar Grid.Row="3" Background="#FF3A4F7A" Foreground="White">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" FontWeight="SemiBold"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>